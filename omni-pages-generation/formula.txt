=IF([Program Area: Input]@row = "", "", SUBSTITUTE(IFERROR(VLOOKUP(LEFT([Program Area: Input]@row, FIND(CHAR(10), [Program Area: Input]@row + CHAR(10)) - 1), {Departments -  Programs Range 3}, 3, false), "") + IF(LEN(MID([Program Area: Input]@row, FIND(CHAR(10), [Program Area: Input]@row + CHAR(10)) + 1, 10000)) = 0, "", CHAR(10) + IFERROR(VLOOKUP(LEFT(MID([Program Area: Input]@row, FIND(CHAR(10), [Program Area: Input]@row + CHAR(10)) + 1, 10000), FIND(CHAR(10), MID([Program Area: Input]@row, FIND(CHAR(10), [Program Area: Input]@row + CHAR(10)) + 1, 10000) + CHAR(10)) - 1), {Departments -  Programs Range 3}, 3, false), "")) + IF(LEN(MID(MID([Program Area: Input]@row, FIND(CHAR(10), [Program Area: Input]@row + CHAR(10)) + 1, 10000), FIND(CHAR(10), MID([Program Area: Input]@row, FIND(CHAR(10), [Program Area: Input]@row + CHAR(10)) + 1, 10000) + CHAR(10)) + 1, 10000)) = 0, "", CHAR(10) + IFERROR(VLOOKUP(LEFT(MID(MID([Program Area: Input]@row, FIND(CHAR(10), [Program Area: Input]@row + CHAR(10)) + 1, 10000), FIND(CHAR(10), MID([Program Area: Input]@row, FIND(CHAR(10), [Program Area: Input]@row + CHAR(10)) + 1, 10000) + CHAR(10)) + 1, 10000), FIND(CHAR(10), MID(MID([Program Area: Input]@row, FIND(CHAR(10), [Program Area: Input]@row + CHAR(10)) + 1, 10000), FIND(CHAR(10), MID([Program Area: Input]@row, FIND(CHAR(10), [Program Area: Input]@row + CHAR(10)) + 1, 10000) + CHAR(10)) + 1, 10000) + CHAR(10)) - 1), {Departments -  Programs Range 3}, 3, false), "")) + IF(LEN(MID(MID(MID([Program Area: Input]@row, FIND(CHAR(10), [Program Area: Input]@row + CHAR(10)) + 1, 10000), FIND(CHAR(10), MID([Program Area: Input]@row, FIND(CHAR(10), [Program Area: Input]@row + CHAR(10)) + 1, 10000) + CHAR(10)) + 1, 10000), FIND(CHAR(10), MID(MID([Program Area: Input]@row, FIND(CHAR(10), [Program Area: Input]@row + CHAR(10)) + 1, 10000), FIND(CHAR(10), MID([Program Area: Input]@row, FIND(CHAR(10), [Program Area: Input]@row + CHAR(10)) + 1, 10000) + CHAR(10)) + 1, 10000) + CHAR(10)) + 1, 10000)) = 0, "", CHAR(10) + IFERROR(VLOOKUP(LEFT(MID(MID(MID([Program Area: Input]@row, FIND(CHAR(10), [Program Area: Input]@row + CHAR(10)) + 1, 10000), FIND(CHAR(10), MID([Program Area: Input]@row, FIND(CHAR(10), [Program Area: Input]@row + CHAR(10)) + 1, 10000) + CHAR(10)) + 1, 10000), FIND(CHAR(10), MID(MID([Program Area: Input]@row, FIND(CHAR(10), [Program Area: Input]@row + CHAR(10)) + 1, 10000), FIND(CHAR(10), MID([Program Area: Input]@row, FIND(CHAR(10), [Program Area: Input]@row + CHAR(10)) + 1, 10000) + CHAR(10)) + 1, 10000) + CHAR(10)) + 1, 10000), FIND(CHAR(10), MID(MID(MID([Program Area: Input]@row, FIND(CHAR(10), [Program Area: Input]@row + CHAR(10)) + 1, 10000), FIND(CHAR(10), MID([Program Area: Input]@row, FIND(CHAR(10), [Program Area: Input]@row + CHAR(10)) + 1, 10000) + CHAR(10)) + 1, 10000), FIND(CHAR(10), MID(MID([Program Area: Input]@row, FIND(CHAR(10), [Program Area: Input]@row + CHAR(10)) + 1, 10000), FIND(CHAR(10), MID([Program Area: Input]@row, FIND(CHAR(10), [Program Area: Input]@row + CHAR(10)) + 1, 10000) + CHAR(10)) + 1, 10000) + CHAR(10)) + 1, 10000) + CHAR(10)) - 1), {Departments -  Programs Range 3}, 3, false), "")), CHAR(10), ", "))